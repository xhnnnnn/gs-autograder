#!/usr/bin/env Rscript
suppressPackageStartupMessages(library(gradeR))

# Always run inside the submission directory
setwd("/autograder/submission")

# Adjust file names for your assignment
student_in  <- "HW06_TidyPart02.R"
tests_path  <- "/autograder/source/tests.R"
results_dst <- "/autograder/results/results.json"

stopifnot(file.exists(student_in), file.exists(tests_path))

# Pass student file path to tests if needed
Sys.setenv(GS_STUDENT_FILE = normalizePath(student_in, winslash = "/", mustWork = TRUE))

# Run the test suite; gradeR will generate results.json
calcGradesForGradescope(student_in, tests_path)

# Fallback copy in case gradeR writes to CWD
if (!file.exists(results_dst) && file.exists("results.json")) {
  file.copy("results.json", results_dst, overwrite = TRUE)
}
